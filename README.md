Про что написать:

хелм чарты отделньно
алертинг
приложение



# K8s
В качестве среды k8s для развертывания приложения был выбран managed k8s yandex cloud.

Тип мастера: Региональный
Версия: 1.28
Кластер, worker nodes и остальные облачные ресурсы описываются при помощи terraform и деплоятся через jenkins job.

Ноды развернуты в разных сетевых сегментах (ru-central1-a и ru-central1-b)

# Terraform

Версия: 1.7.2
Описание инфраструктуры хранистя в terraform
Для хранения state файлов подключен s3 backend,(yandex cloud) секрет для подключения хранится в jenkins(terraform_key_sa.json)

# Jenkins

Версия: 2.426.3
Используется как предустановленное на ВМ решение yandex cloud marketplace
Декларативные пайпланы находятся в директории jenkins

![Alt text](pics/jenkins.png?raw=true "jenkins")


# Логика работы

1) Первым запускается пайплайн terraform.groovy для применения ресурсов в облако.
Для корректной работы в секреты jenkins нужно добавить AWS_ACCESS_KEY_ID AWS_SECRET_ACCESS_KEY terraform_key_sa (ключ создается в терминальной утилите yc)

2) После успешного создания инфраструктуры нужно получить необходимые секреты для работы приожения/инфраструктурных компонентов. 
    Для этого придется совершить ряд ручных действий:
     - Заполнить переменные CLUSTER_ID и SOPS_PGP в bash скрипте etc/get_yc_credentials.sh
     - Запустить bash скрипт 
     - Секреты docker (pull/puss) и kubeconfig добавить в jenkins
     - Секреты инфраструктурных helm чартов скопировать в папку helmfile_infra (создаются уже шифрованные через sops)
     - В Jenkins загрузить файл с gpg ключами для расшифровки (Без passphrase)
     - Запустить jenkins задачу для деплоя инфраструктурных helm чартов

# Инфраструктурные helm чарты









